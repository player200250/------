<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>å“¡å·¥å‡ºå‹¤ç®¡ç† - XXXæ¬å®¶å…¬å¸</title>
    <link rel="stylesheet" href="employee.css">
    <style>
        /*å’Œå“¡å·¥å»ºç½®ä¸€æ¨£çš„æ’ç‰ˆ*/
        .search-container {
            background-color: #ffffff;
            margin: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            /* æš«æ™‚çš„é‚Šæ¡† */
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* å‡ºå‹¤å°ˆç”¨çš„çµ±è¨ˆå¡ç‰‡ç¾åŒ– */
        .attendance-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .employee-table1 {
            background-color: #ffffff;
            margin: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            /* æš«æ™‚çš„é‚Šæ¡† */
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-title {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border-bottom: 4px solid #0056b3;
        }

        .stat-card.alert {
            border-bottom-color: #ff5252;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #c2185b;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* è¡¨æ ¼å…§ç‹€æ…‹æ¨™ç±¤ */
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .status-ok {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-late {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status-leave {
            background: #ffebee;
            color: #d32f2f;
        }
    </style>
</head>

<body>
    <header class="top-header">
        <div class="company-name">XXXæ¬å®¶å…¬å¸</div>
        <div class="user-info">
            <span class="status-dot"></span>
            <div class="greeting-box">æ—©å®‰ï¼ŒXXX</div>
        </div>
    </header>

    <div class="main-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>äººåŠ›ç®¡ç†æ¨¡çµ„</h3>
            </div>
            <nav class="sidebar-menu">
                <ul>
                    <li onclick="location.href='employee.html'"><i class="icon">ğŸ‘¤</i> å“¡å·¥è³‡æ–™ç®¡ç†</li>
                    <li class="active"><i class="icon">ğŸ“…</i> å“¡å·¥å‡ºå‹¤ç®¡ç†</li>
                    <li><i class="icon">ğŸ–ï¸</i> å“¡å·¥è«‹å‡ç®¡ç†</li>
                    <li onclick="location.href='disable_employee.html'"><i class="icon">ğŸ“‘</i> äººäº‹ç•°å‹•ç®¡ç†</li>
                </ul>
            </nav>
        </aside>

        <main class="content-area">
            <section class="search-container">

                <h2 class="form-title">ä»Šæ—¥å‡ºå‹¤æ¦‚æ³ (2025-09-07)</h2>

                <div class="attendance-stats">
                    <div class="stat-card">
                        <span class="stat-value">42</span>
                        <span class="stat-label">æ‡‰åˆ°äººæ•¸</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" style="color: #2e7d32;">38</span>
                        <span class="stat-label">å¯¦åˆ°äººæ•¸</span>
                    </div>
                    <div class="stat-card alert">
                        <span class="stat-value">3</span>
                        <span class="stat-label">é²åˆ°äººæ•¸</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" style="color: #007bff;">1</span>
                        <span class="stat-label">è«‹å‡ä¸­</span>
                    </div>
                </div>
            </section>
            <section class="data-table-container">
                <div class="search-container" style="margin-bottom: 15px;">
                    <input type="date" class="search-input" id="att-date">
                    <button class="search-btn">åˆ‡æ›æ—¥æœŸ</button>
                </div>
                <section class="employee-table1">

                    <table class="employee-table">
                        <thead>
                            <tr>
                                <th>å“¡å·¥ç·¨è™Ÿ</th>
                                <th>å§“å</th>
                                <th>ä¸Šç­æ‰“å¡</th>
                                <th>ä¸‹ç­æ‰“å¡</th>
                                <th>ç›®å‰ç‹€æ…‹</th>
                                <th>å‚™è¨»</th>
                            </tr>
                        </thead>
                        <tbody id ="attendance-list">
                            <tr data-id="EMP001">
                                <td>EMP001</td>
                                <td>ç‹æ›‰æ˜</td>
                                <td class="time-in">08:55:12</td>
                                <td>18:05:44</td>
                                <td class="status-cell"><span class="time-badge status-on">æ­£å¸¸</span></td>
                                <td>
                                    <button class="btn-edit" onclick="editAttendance('EMP001')">ç·¨è¼¯</button>
                                </td>
                            </tr>
                            <tr data-id="EMP002">
                                <td>EMP002</td>
                                <td>é™³æ›‰ç¾</td>
                                <td class="time-in">09:15:20</td>
                                <td>--:--:--</td>
                                <td class="status-cell"><span class="time-badge status-late">é²åˆ°</span></td>
                                <td>
                                    <button class="btn-edit" onclick="editAttendance('EMP002')">ç·¨è¼¯</button>
                                </td>
                            </tr>
                        </tbody=attendance-list>
                    </table>
                </section>
            </section>
        </main>
    </div>
</body>
<script>// å¯ä»¥ä¿®æ”¹å‡ºå‹¤ç‹€æ…‹
    function editAttendance(empId) {
        const row = document.querySelector(`tr[data-id="${empId}"]`);
        const timeCell = row.querySelector('.time-in');
        const statusCell = row.querySelector('.status-cell');

        // 1. æŠŠæ–‡å­—è®Šæˆè¼¸å…¥æ¡†
        const currentTime = timeCell.innerText;
        timeCell.innerHTML = `<input type="time" value="${currentTime}" id="edit-time-${empId}">`;

        // 2. æŠŠç‹€æ…‹è®Šæˆä¸‹æ‹‰é¸å–®
        statusCell.innerHTML = `
        <select id="edit-status-${empId}">
            <option value="æ­£å¸¸">æ­£å¸¸</option>
            <option value="é²åˆ°">é²åˆ°</option>
            <option value="è«‹å‡">è«‹å‡</option>
        </select>
    `;

        // 3. æŠŠæŒ‰éˆ•è®Šæˆã€Œå„²å­˜ã€
        const btn = row.querySelector('.btn-edit');
        btn.innerText = 'ğŸ’¾ å„²å­˜';
        btn.onclick = () => saveAttendance(empId);
    }

    // 1. åˆå§‹åŒ–ï¼šé é¢è¼‰å…¥å¾Œè‡ªå‹•çµ±è¨ˆä¸€æ¬¡
document.addEventListener('DOMContentLoaded', () => {
    updateStats();
});

// 2. è‡ªå‹•çµ±è¨ˆé­”æ³• (ç¢ºä¿ ID æœ‰å°é½Š)
function updateStats() {
    // é€™è£¡æ”¹ç”¨é¸å– tbody è£¡çš„ trï¼Œæ›´ä¿éšªï¼
    const rows = document.querySelectorAll('#attendance-list tr');
    
    let totalExpected = rows.length; 
    let presentCount = 0;           
    let lateCount = 0;              
    let leaveCount = 0;             

    rows.forEach(row => {
        const badge = row.querySelector('.time-badge');
        if (badge) {
            const statusText = badge.innerText.trim();
            if (statusText === 'æ­£å¸¸') {
                presentCount++;
            } else if (statusText === 'é²åˆ°') {
                presentCount++; 
                lateCount++;
            } else if (statusText === 'è«‹å‡') {
                leaveCount++;
            }
        }
    });

    const statValues = document.querySelectorAll('.stat-value');
    if (statValues.length >= 4) {
        statValues[0].innerText = totalExpected; // æ‡‰åˆ°
        statValues[1].innerText = presentCount;  // å¯¦åˆ°
        statValues[2].innerText = lateCount;     // é²åˆ°
        statValues[3].innerText = leaveCount;    // è«‹å‡
    }
}

// 3. é€²å…¥ç·¨è¼¯æ¨¡å¼
function editAttendance(empId) {
    const row = document.querySelector(`tr[data-id="${empId}"]`);
    if (!row) return;

    const timeInCell = row.querySelector('.time-in');
    const timeOutCell = row.cells[3]; 
    const statusCell = row.querySelector('.status-cell');

    const currentTimeIn = timeInCell.innerText;
    const currentTimeOut = timeOutCell.innerText === '--:--:--' ? '' : timeOutCell.innerText;
    const currentStatus = statusCell.innerText.trim();

    timeInCell.innerHTML = `<input type="time" step="1" value="${currentTimeIn}" id="edit-timein-${empId}" style="width: 100px;">`;
    timeOutCell.innerHTML = `<input type="time" step="1" value="${currentTimeOut}" id="edit-timeout-${empId}" style="width: 100px;">`;

    statusCell.innerHTML = `
        <select id="edit-status-${empId}">
            <option value="æ­£å¸¸" ${currentStatus === 'æ­£å¸¸' ? 'selected' : ''}>æ­£å¸¸</option>
            <option value="é²åˆ°" ${currentStatus === 'é²åˆ°' ? 'selected' : ''}>é²åˆ°</option>
            <option value="è«‹å‡" ${currentStatus === 'è«‹å‡' ? 'selected' : ''}>è«‹å‡</option>
        </select>
    `;

    const btn = row.querySelector('.btn-edit');
    btn.innerText = 'ğŸ’¾ å„²å­˜';
    btn.onclick = () => saveAttendance(empId);
}

// 4. å„²å­˜ä¿®æ”¹ (é€™å€‹ç‰ˆæœ¬æœ€å®Œæ•´ï¼)
function saveAttendance(empId) {
    const timeInInput = document.getElementById(`edit-timein-${empId}`);
    const timeOutInput = document.getElementById(`edit-timeout-${empId}`);
    const statusSelect = document.getElementById(`edit-status-${empId}`);

    if (!timeInInput || !statusSelect) return;

    const newTimeIn = timeInInput.value;
    const newTimeOut = timeOutInput.value || '--:--:--';
    const newStatus = statusSelect.value;

    const row = document.querySelector(`tr[data-id="${empId}"]`);
    const timeInCell = row.querySelector('.time-in');
    const timeOutCell = row.cells[3];
    const statusCell = row.querySelector('.status-cell');

    timeInCell.innerText = newTimeIn;
    timeOutCell.innerText = newTimeOut;

    let badgeClass = 'status-on'; 
    if (newStatus === 'é²åˆ°') badgeClass = 'status-late';
    if (newStatus === 'è«‹å‡') badgeClass = 'status-leave';

    statusCell.innerHTML = `<span class="time-badge ${badgeClass}">${newStatus}</span>`;

    const btn = row.querySelector('.btn-edit');
    btn.innerText = 'ç·¨è¼¯';
    btn.onclick = () => editAttendance(empId);

    // âœ¨ å„²å­˜å¾Œç«‹åˆ»æ›´æ–°çµ±è¨ˆæ•¸å­—ï¼
    updateStats();
}
</script>

</html>