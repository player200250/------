<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å“¡å·¥å‡ºå‹¤ç®¡ç† - XXXæ¬å®¶å…¬å¸</title>
    <link rel="stylesheet" href="employee.css">
    <style>
        .search-container { background-color: #ffffff; margin: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; display: flex; flex-direction: column; gap: 15px; }
        .attendance-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 25px; }
        .employee-table1 { background-color: #ffffff; margin: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; display: flex; flex-direction: column; gap: 15px; }
        .form-title { font-size: 1.2rem; font-weight: bold; text-align: center; margin-bottom: 10px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); border-bottom: 4px solid #0056b3; }
        .stat-card.alert { border-bottom-color: #ff5252; }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: #c2185b; display: block; }
        .stat-label { color: #666; font-size: 0.9rem; }
        .time-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; }
        .status-on { background: #e8f5e9; color: #2e7d32; }
        .status-late { background: #fff3e0; color: #ef6c00; }
        .status-leave { background: #ffebee; color: #d32f2f; }
    </style>
</head>
<body>
    <header class="top-header">
        <div class="company-name">XXXæ¬å®¶å…¬å¸</div>
        <div class="user-info">
            <span class="status-dot"></span>
            <div class="greeting-box">æ—©å®‰ï¼ŒXXX</div>
        </div>
    </header>

    <div class="main-layout">
        <aside class="sidebar">
            <div class="sidebar-header"><h3>äººåŠ›ç®¡ç†æ¨¡çµ„</h3></div>
            <nav class="sidebar-menu">
                <ul>
                    <li onclick="location.href='employee.html'"><i class="icon">ğŸ‘¤</i> å“¡å·¥è³‡æ–™ç®¡ç†</li>
                    <li class="active"><i class="icon">ğŸ“…</i> å“¡å·¥å‡ºå‹¤ç®¡ç†</li>
                    <li><i class="icon">ğŸ–ï¸</i> å“¡å·¥è«‹å‡ç®¡ç†</li>
                    <li onclick="location.href='disable_employee.html'"><i class="icon">ğŸ“‘</i> äººäº‹ç•°å‹•ç®¡ç†</li>
                </ul>
            </nav>
        </aside>

        <main class="content-area">
            <section class="search-container">
                <h2 class="form-title" id="display-date">ä»Šæ—¥å‡ºå‹¤æ¦‚æ³</h2>
                <div class="attendance-stats">
                    <div class="stat-card">
                        <span class="stat-value">0</span>
                        <span class="stat-label">æ‡‰åˆ°äººæ•¸</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" style="color: #2e7d32;">0</span>
                        <span class="stat-label">å¯¦åˆ°äººæ•¸</span>
                    </div>
                    <div class="stat-card alert">
                        <span class="stat-value">0</span>
                        <span class="stat-label">é²åˆ°äººæ•¸</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" style="color: #007bff;">0</span>
                        <span class="stat-label">è«‹å‡ä¸­</span>
                    </div>
                </div>
            </section>

            <section class="data-table-container">
                <div class="search-container" style="margin-bottom: 15px;">
                    <input type="date" class="search-input" id="att-date">
                    <button class="search-btn" onclick="updateDateTitle()">åˆ‡æ›æ—¥æœŸ</button>
                </div>
                <section class="employee-table1">
                    <table class="employee-table">
                        <thead>
                            <tr>
                                <th>å“¡å·¥ç·¨è™Ÿ</th>
                                <th>å§“å</th>
                                <th>ä¸Šç­æ‰“å¡</th>
                                <th>ä¸‹ç­æ‰“å¡</th>
                                <th>ç›®å‰ç‹€æ…‹</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-list">
                            <tr data-id="EMP001">
                                <td>EMP001</td>
                                <td>ç‹æ›‰æ˜</td>
                                <td class="time-in">08:55:12</td>
                                <td class="time-out">18:05:44</td>
                                <td class="status-cell"><span class="time-badge status-on">æ­£å¸¸</span></td>
                                <td><button class="btn-edit" onclick="editAttendance('EMP001')">ç·¨è¼¯</button></td>
                            </tr>
                            <tr data-id="EMP002">
                                <td>EMP002</td>
                                <td>é™³æ›‰ç¾</td>
                                <td class="time-in">09:15:20</td>
                                <td class="time-out">--:--:--</td>
                                <td class="status-cell"><span class="time-badge status-late">é²åˆ°</span></td>
                                <td><button class="btn-edit" onclick="editAttendance('EMP002')">ç·¨è¼¯</button></td>
                            </tr>
                        </tbody>
                    </table>
                </section>
            </section>
        </main>
    </div>

    <script>
        // 1. åˆå§‹åŒ–è¨­å®š
        document.addEventListener('DOMContentLoaded', () => {
            const dateInput = document.getElementById('att-date');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.value = today;
                document.getElementById('display-date').innerText = `ä»Šæ—¥å‡ºå‹¤æ¦‚æ³ (${today})`;
            }
            updateStats();
        });

        // 2. åˆ‡æ›æ—¥æœŸæ¨™é¡Œçš„å°åŠŸèƒ½
        function updateDateTitle() {
            const dateValue = document.getElementById('att-date').value;
            if (dateValue) {
                document.getElementById('display-date').innerText = `ä»Šæ—¥å‡ºå‹¤æ¦‚æ³ (${dateValue})`;
            }
        }

        // 3. çµ±è¨ˆæ•¸å­—é‚è¼¯
        function updateStats() {
            const rows = document.querySelectorAll('#attendance-list tr');
            let total = rows.length, present = 0, late = 0, leave = 0;

            rows.forEach(row => {
                const status = row.querySelector('.time-badge')?.innerText.trim();
                if (status === 'æ­£å¸¸') { present++; }
                else if (status === 'é²åˆ°') { present++; late++; }
                else if (status === 'è«‹å‡') { leave++; }
            });

            const stats = document.querySelectorAll('.stat-value');
            if (stats.length >= 4) {
                stats[0].innerText = total;
                stats[1].innerText = present;
                stats[2].innerText = late;
                stats[3].innerText = leave;
            }
        }

        // 4. é€²å…¥ç·¨è¼¯æ¨¡å¼
        function editAttendance(empId) {
            const row = document.querySelector(`tr[data-id="${empId}"]`);
            const timeInCell = row.querySelector('.time-in');
            const timeOutCell = row.querySelector('.time-out') || row.cells[3]; // å¢åŠ ç›¸å®¹æ€§
            const statusCell = row.querySelector('.status-cell');

            const currIn = timeInCell.innerText;
            const currOut = timeOutCell.innerText === '--:--:--' ? '' : timeOutCell.innerText;
            const currStatus = statusCell.innerText.trim();

            timeInCell.innerHTML = `<input type="time" step="1" value="${currIn}" id="edit-timein-${empId}" style="width: 100px;">`;
            timeOutCell.innerHTML = `<input type="time" step="1" value="${currOut}" id="edit-timeout-${empId}" style="width: 100px;">`;
            statusCell.innerHTML = `
                <select id="edit-status-${empId}">
                    <option value="æ­£å¸¸" ${currStatus === 'æ­£å¸¸' ? 'selected' : ''}>æ­£å¸¸</option>
                    <option value="é²åˆ°" ${currStatus === 'é²åˆ°' ? 'selected' : ''}>é²åˆ°</option>
                    <option value="è«‹å‡" ${currStatus === 'è«‹å‡' ? 'selected' : ''}>è«‹å‡</option>
                </select>`;

            const btn = row.querySelector('.btn-edit');
            btn.innerText = 'ğŸ’¾ å„²å­˜';
            btn.onclick = () => saveAttendance(empId);
        }

        // 5. å„²å­˜å›è¡¨æ ¼
        function saveAttendance(empId) {
            const valIn = document.getElementById(`edit-timein-${empId}`).value || '--:--:--';
            const valOut = document.getElementById(`edit-timeout-${empId}`).value || '--:--:--';
            const valStatus = document.getElementById(`edit-status-${empId}`).value;

            const row = document.querySelector(`tr[data-id="${empId}"]`);
            const timeInCell = row.querySelector('.time-in');
            const timeOutCell = row.querySelector('.time-out') || row.cells[3];
            const statusCell = row.querySelector('.status-cell');

            timeInCell.innerText = valIn;
            timeOutCell.innerText = valOut;

            let cls = 'status-on';
            if (valStatus === 'é²åˆ°') cls = 'status-late';
            if (valStatus === 'è«‹å‡') cls = 'status-leave';

            statusCell.innerHTML = `<span class="time-badge ${cls}">${valStatus}</span>`;

            const btn = row.querySelector('.btn-edit');
            btn.innerText = 'ç·¨è¼¯';
            btn.onclick = () => editAttendance(empId);

            updateStats(); // å„²å­˜å¾Œç«‹å³é‡æ–°è¨ˆç®—äººæ•¸
        }
    </script>
</body>
</html>